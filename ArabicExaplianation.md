<div dir="rtl">

# نظام تسجيل الجامعة - توثيق المشروع

## نظرة عامة على المشروع

هذا المشروع هو نظام شامل لتسجيل المواد الجامعية تم بناؤه باستخدام Node.js وExpress وSQLite. يوفر النظام منصة لإدارة الجامعة والطلاب لإدارة تسجيلات المواد والتسجيلات والتقدم الأكاديمي. تم تصميم النظام بفصل واضح بين واجهات المسؤول والطالب، مع آليات مناسبة للمصادقة والتفويض.

## التقنيات المستخدمة

- **الخلفية (Backend)**:
  - **Node.js**: بيئة تشغيل JavaScript على الخادم تسمح بتنفيذ كود JavaScript خارج المتصفح. تم اختيارها لسرعتها وكفاءتها في معالجة الطلبات المتزامنة وقدرتها على التعامل مع عدد كبير من الاتصالات في وقت واحد.
  - **Express.js**: إطار عمل ويب لـ Node.js يوفر مجموعة من الميزات لبناء تطبيقات الويب وواجهات برمجة التطبيقات (APIs). يسهل إدارة المسارات (routes) والطلبات (requests) والاستجابات (responses) ويدعم الوسائط (middleware) لتنفيذ وظائف مثل المصادقة والتحقق من الصلاحيات.

- **قاعدة البيانات**:
  - **SQLite**: نظام قاعدة بيانات خفيف الوزن قائم على الملفات لا يحتاج إلى خادم منفصل. تم اختياره لبساطته وسهولة استخدامه وعدم الحاجة إلى إعداد معقد، مما يجعله مثاليًا للتطبيقات الصغيرة إلى المتوسطة.
  - **مكتبة sqlite3**: حزمة Node.js التي توفر واجهة برمجة للتفاعل مع قواعد بيانات SQLite، مما يسمح بإجراء عمليات الاستعلام والإدراج والتحديث والحذف.

- **إدارة الجلسات**:
  - **express-session**: وسيط (middleware) لـ Express يدير جلسات المستخدمين، مما يسمح بتخزين بيانات المستخدم بين الطلبات المختلفة. يستخدم لتتبع حالة تسجيل الدخول وتخزين معلومات المستخدم أثناء استخدامه للنظام.

- **الواجهة الأمامية (Frontend)**:
  - **HTML**: لغة ترميز لإنشاء هيكل صفحات الويب.
  - **CSS**: لغة أوراق الأنماط المستخدمة لتنسيق وتصميم صفحات الويب.
  - **JavaScript (vanilla)**: لغة البرمجة الأساسية للويب المستخدمة لإضافة التفاعلية إلى صفحات الويب. تم استخدام JavaScript الأصلي (vanilla) بدون أطر عمل إضافية للحفاظ على البساطة وتقليل حجم التحميل.

- **المصادقة**:
  - **مصادقة مخصصة قائمة على الجلسات**: نظام مصادقة تم تطويره خصيصًا للمشروع يعتمد على جلسات المستخدم لتتبع حالة تسجيل الدخول والصلاحيات. يتحقق من بيانات اعتماد المستخدم مقابل قاعدة البيانات ويخزن معلومات المستخدم في الجلسة عند نجاح تسجيل الدخول.

## هيكل المشروع

يتبع المشروع هيكلًا نمطيًا:

```
/
├── .data/                  # تخزين قاعدة البيانات (للاستمرارية)
├── node_modules/           # تبعيات Node.js
├── public/                 # ملفات الواجهة الأمامية الثابتة
│   ├── admin/              # واجهة المسؤول
│   ├── css/                # أوراق الأنماط
│   ├── images/             # الصور والأصول
│   ├── js/                 # ملفات JavaScript
│   ├── student/            # واجهة الطالب
│   └── index.html          # صفحة تسجيل الدخول الرئيسية
├── server/                 # كود الخلفية
│   ├── database.js         # اتصال قاعدة البيانات والمخطط
│   ├── server.js           # خادم Express ومسارات API
│   └── university.db       # قالب قاعدة البيانات الأولي
├── .env                    # متغيرات البيئة
├── .gitignore              # ملف تجاهل Git
├── check-db.js             # أداة للتحقق من قاعدة البيانات
├── check-max-limit.js      # أداة للتحقق من حدود التسجيل
├── index.js                # نقطة الدخول الرئيسية
├── package.json            # بيانات المشروع والتبعيات
├── package-lock.json       # ملف قفل التبعيات
├── README.md               # توثيق المشروع
├── reset-enrollments.js    # أداة لإعادة تعيين التسجيلات
├── update-auto-logout.js   # أداة لتحديث إعدادات الخروج التلقائي
└── update-max-limit.js     # أداة لتحديث حدود التسجيل
```

## مخطط قاعدة البيانات

يستخدم النظام SQLite مع هيكل الجداول التالي:

### 1. المستخدمون (users)
- `id`: المفتاح الرئيسي
- `username`: اسم المستخدم الفريد (رقم الطالب للطلاب)
- `password`: كلمة المرور (رقم التسجيل للطلاب)
- `role`: دور المستخدم ('admin' أو 'student')
- `created_at`: الطابع الزمني

### 2. الأقسام (departments)
- `id`: المفتاح الرئيسي
- `name`: اسم القسم
- `created_at`: الطابع الزمني

### 3. الطلاب (students)
- `id`: المفتاح الرئيسي
- `student_id`: رقم الطالب الفريد
- `user_id`: مفتاح خارجي لجدول المستخدمين
- `name`: اسم الطالب
- `department_id`: مفتاح خارجي لجدول الأقسام
- `registration_number`: رقم التسجيل الفريد
- `semester`: الفصل الدراسي الحالي
- `group_name`: اسم المجموعة (اختياري)
- `created_at`: الطابع الزمني

### 4. المواد (courses)
- `id`: المفتاح الرئيسي
- `course_code`: رمز المادة الفريد
- `name`: اسم المادة
- `department_id`: مفتاح خارجي لجدول الأقسام
- `max_students`: الحد الأقصى لعدد الطلاب المسموح به
- `semester`: الفصل الدراسي للمادة
- `created_at`: الطابع الزمني

### 5. المتطلبات السابقة (prerequisites)
- `id`: المفتاح الرئيسي
- `course_id`: مفتاح خارجي لجدول المواد
- `prerequisite_id`: مفتاح خارجي لجدول المواد
- `created_at`: الطابع الزمني

### 6. التسجيلات (enrollments)
- `id`: المفتاح الرئيسي
- `student_id`: مفتاح خارجي لجدول الطلاب
- `course_id`: مفتاح خارجي لجدول المواد
- `group_id`: مفتاح خارجي لجدول مجموعات المواد
- `status`: حالة التسجيل
- `created_at`: الطابع الزمني

### 7. المواد المكتملة (completed_courses)
- `id`: المفتاح الرئيسي
- `student_id`: مفتاح خارجي لجدول الطلاب
- `course_id`: مفتاح خارجي لجدول المواد
- `completed_at`: الطابع الزمني

### 8. مجموعات المواد (course_groups)
- `id`: المفتاح الرئيسي
- `course_id`: مفتاح خارجي لجدول المواد
- `group_name`: اسم المجموعة
- `max_students`: الحد الأقصى للطلاب في المجموعة
- `professor_name`: اسم الأستاذ
- `time_slot`: وقت المحاضرة
- `created_at`: الطابع الزمني

### 9. إعدادات النظام (system_settings)
- `id`: المفتاح الرئيسي
- `key`: مفتاح الإعداد
- `value`: قيمة الإعداد
- `created_at`: الطابع الزمني
- `updated_at`: الطابع الزمني للتحديث

## المصادقة والتفويض

ينفذ النظام آلية مصادقة قائمة على الجلسات:

1. **عملية تسجيل الدخول**:
   - يقدم المستخدمون اسم المستخدم وكلمة المرور
   - يتحقق الخادم من بيانات الاعتماد مقابل قاعدة البيانات
   - عند نجاح المصادقة، يتم إنشاء جلسة مع معلومات المستخدم

2. **التفويض**:
   - تتحقق وظائف الوسيط من دور المستخدم وصلاحية الجلسة
   - يتم حماية المسارات المختلفة بناءً على دور المستخدم (مسؤول أو طالب)
   - يمكن تكوين مهلة الجلسة من خلال إعدادات النظام

## نقاط نهاية API

### المصادقة
- `POST /api/login`: مصادقة المستخدم
- `GET /api/logout`: إنهاء جلسة المستخدم
- `GET /api/user`: الحصول على معلومات المستخدم الحالي

### مسارات المسؤول
- **إدارة الطلاب**:
  - `GET /api/admin/students`: الحصول على جميع الطلاب
  - `GET /api/admin/students/:id`: الحصول على تفاصيل الطالب
  - `POST /api/admin/students`: إضافة طالب جديد
  - `PUT /api/admin/students/:id`: تحديث بيانات الطالب
  - `DELETE /api/admin/students/:id`: حذف طالب
  - `GET /api/admin/students/:id/courses`: الحصول على مواد الطالب

- **إدارة الأقسام**:
  - `GET /api/admin/departments`: الحصول على جميع الأقسام
  - `GET /api/admin/departments/:id`: الحصول على تفاصيل القسم
  - `POST /api/admin/departments`: إضافة قسم جديد
  - `PUT /api/admin/departments/:id`: تحديث بيانات القسم
  - `DELETE /api/admin/departments/:id`: حذف قسم

- **إدارة المواد**:
  - `GET /api/admin/courses`: الحصول على جميع المواد
  - `GET /api/admin/courses/:id`: الحصول على تفاصيل المادة
  - `POST /api/admin/courses`: إضافة مادة جديدة
  - `PUT /api/admin/courses/:id`: تحديث بيانات المادة
  - `DELETE /api/admin/courses/:id`: حذف مادة
  - `GET /api/admin/courses/:id/prerequisites`: الحصول على المتطلبات السابقة للمادة

- **إدارة المتطلبات السابقة**:
  - `POST /api/admin/prerequisites`: إضافة متطلب سابق
  - `DELETE /api/admin/prerequisites/:id`: حذف متطلب سابق

- **إدارة التسجيلات**:
  - `POST /api/admin/completed-courses`: تحديد مادة كمكتملة
  - `DELETE /api/admin/completed-courses/:id`: حذف مادة مكتملة
  - `DELETE /api/admin/enrollments/:id`: حذف تسجيل

### مسارات الطالب
- `GET /api/student/info`: الحصول على معلومات الطالب
- `GET /api/student/completed-courses`: الحصول على المواد المكتملة
- `GET /api/student/available-courses`: الحصول على المواد المتاحة
- `POST /api/student/enroll`: التسجيل في مادة
- `DELETE /api/student/enrollments/:id`: إلغاء التسجيل

## منطق الأعمال والقواعد

1. **المتطلبات السابقة للمواد**:
   - يمكن للطلاب التسجيل في المواد فقط إذا أكملوا جميع المتطلبات السابقة
   - يمنع النظام التبعيات الدائرية في المتطلبات السابقة

2. **حدود التسجيل**:
   - لكل مادة حد أقصى من الطلاب
   - يمكن للطلاب التسجيل في عدد محدود من المواد (قابل للتكوين)
   - يتم منع التسجيل إذا كانت المادة ممتلئة

3. **قيود القسم**:
   - يمكن للطلاب التسجيل فقط في المواد من قسمهم
   - لا يمكن حذف الأقسام إذا كان لديها طلاب أو مواد مرتبطة

4. **إكمال المادة**:
   - عندما يتم تحديد مادة كمكتملة، يتم إزالة أي تسجيل في تلك المادة تلقائيًا
   - تحسب المواد المكتملة ضمن متطلبات المتطلبات السابقة

5. **الخروج التلقائي**:
   - ميزة الخروج التلقائي قابلة للتكوين للأمان
   - يمكن ضبط مدة المهلة من خلال إعدادات النظام

## هيكل الواجهة الأمامية

تنقسم الواجهة الأمامية إلى قسمين رئيسيين:

1. **واجهة المسؤول** (`/public/admin/`):
   - لوحة التحكم مع نظرة عامة على النظام
   - إدارة الطلاب
   - إدارة الأقسام
   - إدارة المواد
   - إدارة المتطلبات السابقة
   - إعدادات النظام

2. **واجهة الطالب** (`/public/student/`):
   - لوحة التحكم مع حالة التسجيل
   - عرض المواد المتاحة
   - عرض المواد المسجلة
   - عرض المواد المكتملة

## النشر والبيئة

تم تصميم النظام ليتم نشره على منصات مثل Glitch مع:

- متغيرات البيئة للتكوين
- تخزين قاعدة بيانات مستمر في دليل `.data`
- المنفذ الافتراضي 3000 (قابل للتكوين عبر متغير البيئة PORT)

## اعتبارات الأمان

1. **المصادقة**: قائمة على الجلسات مع مهلة قابلة للتكوين
2. **التفويض**: التحكم في الوصول القائم على الأدوار
3. **التحقق من البيانات**: التحقق من المدخلات على جانبي العميل والخادم
4. **معالجة الأخطاء**: استجابات الخطأ المناسبة دون كشف معلومات حساسة

## التحسينات المستقبلية

1. تجزئة كلمات المرور لتحسين الأمان
2. إشعارات البريد الإلكتروني للتغييرات في حالة التسجيل
3. تقارير وتحليلات متقدمة
4. تحسينات تصميم متجاوب للجوال
5. دعم للفصول الدراسية المتعددة والسنوات الأكاديمية

</div>
